#!/usr/bin/env bash

# -------------------------------------------------------------------
# Script: test.sh
# Description: This script test the output iso using qemu
# Author: Walid A.
# Date: 09/11/2025
# Usage: ./test.sh xxxxx.iso
# -------------------------------------------------------------------

#--------------------------------------------------------------------------------
#
#--------------------------------------------------------------------------------
set -e  # Exit immediately if any command fails
set -u  # Treat unset variables as an error
set -o pipefail  # Make pipelines fail if any command fails

#--------------------------------------------------------------------------------
#
#--------------------------------------------------------------------------------
ISO_PATH="$1"

#--------------------------------------------------------------------------------
# Verify file exists
#--------------------------------------------------------------------------------
if [[ ! -f "$ISO_PATH" ]]; then
  echo "Error: ISO file '$ISO_PATH' not found."
  exit 1
fi

#--------------------------------------------------------------------------------
# Run the ISO in QEMU
#--------------------------------------------------------------------------------
echo "-> Booting ISO: $ISO_PATH"
qemu-system-x86_64 -m 2G -boot d -cdrom "$ISO_PATH"